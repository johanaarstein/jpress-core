"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}(function(a,b){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.FontPicker=b())})(void 0,function(){'use strict';function a(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c}function b(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})}function c(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;k;)try{if(e=1,h&&(i=2&c[0]?h["return"]:c[0]?h["throw"]||((i=h["return"])&&i.call(h),0):h.next)&&!(i=i.call(h,c[1])).done)return i;switch((h=0,i)&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return k.label++,{value:c[1],done:!1};case 5:k.label++,h=c[1],c=[0];continue;case 7:c=k.ops.pop(),k.trys.pop();continue;default:if((i=k.trys,!(i=0<i.length&&i[i.length-1]))&&(6===c[0]||2===c[0])){k=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){k.label=c[1];break}if(6===c[0]&&k.label<i[1]){k.label=i[1],i=c;break}if(i&&k.label<i[2]){k.label=i[2],k.ops.push(c);break}i[2]&&k.ops.pop(),k.trys.pop();continue;}c=b.call(a,k)}catch(a){c=[6,a],h=0}finally{e=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,h,i,j,k={label:0,sent:function sent(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return j={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(j[Symbol.iterator]=function(){return this}),j}function d(a){return a.replace(/\s+/g,"-").toLowerCase()}function e(a){if(a.match(/[^0-9a-z]/i))throw Error("The `pickerId` parameter may only contain letters and digits")}function f(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.overrideMimeType("application/json"),d.open("GET",a,!0),d.onreadystatechange=function(){4===d.readyState&&(200===d.status?b(d.responseText):c(new Error("Response has status code "+d.status)))},d.send()})}function g(e){return b(this,void 0,void 0,function(){var b,g,h,i;return c(this,function(c){switch(c.label){case 0:return b=new URL("https://www.googleapis.com/webfonts/v1/webfonts"),b.searchParams.append("sort","popularity"),b.searchParams.append("key",e),[4,f(b.href)];case 1:return g=c.sent(),h=JSON.parse(g),i=h.items,[2,i.map(function(b){var c=b.family,e=b.subsets,f=a(b,["family","subsets"]);return u(u({},f),{family:c,id:d(c),scripts:e})})];}})})}function h(a,b){var c=d(a.family),e="\n\t\t\t#font-button-"+c+b+" {\n\t\t\t\tfont-family: \""+a.family+"\";\n\t\t\t}\n\t\t";v.appendChild(document.createTextNode(e))}function i(a){var b="active-font-"+a,c=document.getElementById(b);return c||(c=document.createElement("style"),c.id=b,document.head.appendChild(c)),c}function j(a,b,c){var d="\n\t\t.apply-font"+c+" {\n\t\t\tfont-family: \""+a.family+"\""+(b?", \""+b+"\"":"")+";\n\t\t}\n\t",e=i(c);e.innerHTML=d}function k(a){return"font-"+a}function l(a,b){var c=document.getElementById(k(a));return null===b||void 0===b?null!==c:null!==c&&c.getAttribute("data-is-preview")===b.toString()}function m(a,b){var c=document.createElement("style");c.id=k(a),c.setAttribute("data-is-preview",b.toString()),document.head.appendChild(c)}function n(a,b){var c=k(a),d=document.getElementById(c);d?d.textContent=b:console.error("Could not fill stylesheet: Stylesheet with ID \""+c+"\" not found")}function o(a,b){var c=k(a),d=document.getElementById(c);d?d.setAttribute("data-is-preview",b.toString()):console.error("Could not change stylesheet type: Stylesheet with ID \""+c+"\" not found")}function p(a,b){var c,d=[];do c=a.exec(b),c&&d.push(c[1]);while(c);return d}function q(a){var b=p(w,a),c={};return b.forEach(function(a){var b=p(x,a)[0],e=d(b);e in c||(c[e]=""),c[e]+="@font-face {\n"+a+"\n}\n\n"}),c}function r(a,d,e,g){return b(this,void 0,void 0,function(){var b,h,i,j,k;return c(this,function(){return b=new URL("https://fonts.googleapis.com/css"),h=e.join(","),i=a.map(function(a){return a.family+":"+h}),b.searchParams.append("family",i.join("|")),b.searchParams.append("subset",d.join(",")),g&&(j=a.map(function(a){return a.family}).join(""),k=j.split("").filter(function(a,b,c){return c.indexOf(a)===b}).join(""),b.searchParams.append("text",k)),b.searchParams.append("font-display","swap"),[2,f(b.href)]})})}function s(a,d,e,f){return b(this,void 0,void 0,function(){var b,g,i,j;return c(this,function(c){switch(c.label){case 0:return b=Array.from(a.values()),g=b.map(function(a){return a.id}).filter(function(a){return!l(a)}),g.forEach(function(a){return m(a,!0)}),[4,r(b,d,e,!0)];case 1:return i=c.sent(),j=q(i),b.forEach(function(a){if(h(a,f),g.includes(a.id)){if(!(a.id in j))return void console.error("Missing styles for font \""+a.family+"\" (fontId \""+a.id+"\") in Google Fonts response");n(a.id,j[a.id])}}),[2];}})})}function t(a,d,e,f,g){return b(this,void 0,void 0,function(){var b;return c(this,function(c){switch(c.label){case 0:return l(a.id,!1)?(j(a,d,g),[3,3]):[3,1];case 1:return l(a.id,!0)?o(a.id,!1):m(a.id,!1),[4,r([a],e,f,!1)];case 2:b=c.sent(),j(a,d,g),n(a.id,b),c.label=3;case 3:return[2];}})})}var u=function __assign(){return u=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},u.apply(this,arguments)};(function(a,b){void 0===b&&(b={});var c=b.insertAt;if(a&&"undefined"!=typeof document){var d=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css","top"===c?d.firstChild?d.insertBefore(e,d.firstChild):d.appendChild(e):d.appendChild(e),e.styleSheet?e.styleSheet.cssText=a:e.appendChild(document.createTextNode(a))}})("@charset \"UTF-8\";\ndiv[id^=font-picker] {\n  position: relative;\n  display: inline-block;\n  width: 200px;\n  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);\n}\ndiv[id^=font-picker] * {\n  box-sizing: border-box;\n}\ndiv[id^=font-picker] p {\n  margin: 0;\n  padding: 0;\n}\ndiv[id^=font-picker] button {\n  color: inherit;\n  font-size: inherit;\n  background: none;\n  border: 0;\n  outline: none;\n  cursor: pointer;\n}\ndiv[id^=font-picker] .dropdown-button {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  height: 35px;\n  padding: 0 10px;\n}\ndiv[id^=font-picker] .dropdown-button .dropdown-font-name {\n  overflow: hidden;\n  white-space: nowrap;\n}\ndiv[id^=font-picker] .dropdown-icon {\n  margin-left: 10px;\n}\n@-webkit-keyframes spinner {\n  to {\n    transform: rotate(360deg);\n  }\n}\n@keyframes spinner {\n  to {\n    transform: rotate(360deg);\n  }\n}\ndiv[id^=font-picker] .dropdown-icon.loading::before {\n  display: block;\n  width: 10px;\n  height: 10px;\n  border: 2px solid #b2b2b2;\n  border-top-color: #fff;\n  border-radius: 50%;\n  -webkit-animation: spinner 0.6s linear infinite;\n          animation: spinner 0.6s linear infinite;\n  content: \"\";\n}\ndiv[id^=font-picker] .dropdown-icon.finished::before {\n  cursor: pointer;\n display: block;\n  width: 0;\n  height: 0;\n  margin: 0 2px;\n  border-top: 6px solid #fff;\n  border-right: 5px solid transparent;\n  border-left: 5px solid transparent;\n  transition: transform 0.3s;\n  content: \"\";\n}\ndiv[id^=font-picker] .dropdown-icon.error::before {\n  content: \"\u26A0\";\n}\ndiv[id^=font-picker].expanded .dropdown-icon.finished::before {\n  transform: rotate(-180deg);\n}\ndiv[id^=font-picker].expanded ul {\n  max-height: 200px;\n}\ndiv[id^=font-picker] ul {\n  position: absolute;\n  z-index: 99;\n  width: 100%;\n  max-height: 0;\n  margin: 0;\n  padding: 0;\n  overflow-x: hidden;\n  overflow-y: auto;\n  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);\n  transition: 0.3s;\n  -webkit-overflow-scrolling: touch;\n}\ndiv[id^=font-picker] ul li {\n  height: 35px;\n  list-style: none;\n}\ndiv[id^=font-picker] ul li button {\n  display: flex;\n  align-items: center;\n  width: 100%;\n  height: 100%;\n  padding: 0 10px;\n  white-space: nowrap;\n}");var v=document.createElement("style");document.head.appendChild(v);var w=/@font-face {([\s\S]*?)}/gm,x=/font-family: ['"](.*?)['"]/gm,y="Open Sans",z={pickerId:"",families:[],categories:[],scripts:["latin"],variants:["regular"],filter:function filter(){return!0},limit:50,sort:"alphabet"},A=function(){function a(a,b,c,d){void 0===b&&(b=y);var f=c.pickerId,g=void 0===f?z.pickerId:f,h=c.families,i=void 0===h?z.families:h,j=c.categories,k=void 0===j?z.categories:j,l=c.scripts,m=void 0===l?z.scripts:l,n=c.variants,o=void 0===n?z.variants:n,p=c.filter,q=void 0===p?z.filter:p,r=c.limit,s=void 0===r?z.limit:r,t=c.sort,u=void 0===t?z.sort:t;void 0===d&&(d=function(){}),this.fonts=new Map,e(g),this.selectorSuffix=g?"-"+g:"",this.apiKey=a,this.options={pickerId:g,families:i,categories:k,scripts:m,variants:o,filter:q,limit:s,sort:u},this.onChange=d,this.addFont(b,!1),this.setActiveFont(b,!1)}return a.prototype.init=function(){return b(this,void 0,void 0,function(){var a,b,d,e,f,h;return c(this,function(c){switch(c.label){case 0:return[4,g(this.apiKey)];case 1:for(a=c.sent(),b=function(b){var c=a[b];return d.fonts.size>=d.options.limit?"break":void(!d.fonts.has(c.family)&&(0===d.options.families.length||d.options.families.includes(c.family))&&(0===d.options.categories.length||d.options.categories.includes(c.category))&&d.options.scripts.every(function(a){return c.scripts.includes(a)})&&d.options.variants.every(function(a){return c.variants.includes(a)})&&!0===d.options.filter(c)&&d.fonts.set(c.family,c))},d=this,e=0;e<a.length&&(f=b(e),"break"!==f);e+=1);return h=new Map(this.fonts),h["delete"](this.activeFontFamily),s(h,this.options.scripts,this.options.variants,this.selectorSuffix),[2,this.fonts];}})})},a.prototype.getFonts=function(){return this.fonts},a.prototype.addFont=function(a,b){void 0===b&&(b=!0);var c={family:a,id:d(a)};if(this.fonts.set(a,c),b){var e=new Map;e.set(a,c),s(e,this.options.scripts,this.options.variants,this.selectorSuffix)}},a.prototype.removeFont=function(a){this.fonts["delete"](a)},a.prototype.getActiveFont=function(){var a=this.fonts.get(this.activeFontFamily);if(!a)throw Error("Cannot get active font: \""+this.activeFontFamily+"\" is not in the font list");else return a},a.prototype.setActiveFont=function(a,b){var c=this;void 0===b&&(b=!0);var d=this.activeFontFamily,e=this.fonts.get(a);if(!e)throw Error("Cannot update active font: \""+a+"\" is not in the font list");this.activeFontFamily=a,t(e,d,this.options.scripts,this.options.variants,this.selectorSuffix).then(function(){b&&c.onChange(e)})},a.prototype.setOnChange=function(a){this.onChange=a},a}(),B=function(){function a(a,b,c,d){void 0===b&&(b=y);var e=c.pickerId,f=void 0===e?z.pickerId:e,g=c.families,h=void 0===g?z.families:g,i=c.categories,j=void 0===i?z.categories:i,k=c.scripts,l=void 0===k?z.scripts:k,m=c.variants,n=void 0===m?z.variants:m,o=c.filter,p=void 0===o?z.filter:o,q=c.limit,r=void 0===q?z.limit:q,s=c.sort,t=void 0===s?z.sort:s;void 0===d&&(d=function(){}),this.expanded=!1,this.closeEventListener=this.closeEventListener.bind(this),this.toggleExpanded=this.toggleExpanded.bind(this);this.fontManager=new A(a,b,{pickerId:f,families:h,categories:j,scripts:l,variants:n,filter:p,limit:r,sort:t},d),this.generateUI(t)}return a.prototype.generateUI=function(a){var b=this,c=this.fontManager.selectorSuffix,d="font-picker"+c;if(this.fontPickerDiv=document.getElementById(d),!this.fontPickerDiv)throw Error("Missing div with id=\""+d+"\"");var e=document.createElement("button");e.classList.add("dropdown-button"),e.onclick=this.toggleExpanded,e.onkeypress=this.toggleExpanded,e.type="button",this.fontPickerDiv.appendChild(e),this.dropdownFamily=document.createElement("p"),this.dropdownFamily.textContent=this.fontManager.getActiveFont().family,this.dropdownFamily.classList.add("dropdown-font-family"),e.appendChild(this.dropdownFamily);var f=document.createElement("p");f.classList.add("dropdown-icon","loading"),e.appendChild(f),this.fontManager.init().then(function(c){var d=Array.from(c.values());"alphabet"===a&&d.sort(function(a,b){return a.family.localeCompare(b.family)}),b.generateFontList(d),f.classList.replace("loading","finished")})["catch"](function(a){f.classList.replace("loading","error"),console.error("Error trying to fetch the list of available fonts"),console.error(a)})},a.prototype.generateFontList=function(a){var b=this;this.ul=document.createElement("ul"),this.ul.classList.add("font-list"),this.ul.classList.add("theme-background"),a.forEach(function(a){b.addFontLi(a)}),this.fontPickerDiv.appendChild(this.ul);var c=this.fontManager.getActiveFont().family,e=d(c),f="font-button-"+e+this.fontManager.selectorSuffix;this.activeFontButton=document.getElementById(f),this.activeFontButton?this.activeFontButton.classList.add("active-font"):console.error("Could not find font button with ID ("+f+")")},a.prototype.addFontLi=function(a,b){var c=this,e=d(a.family),f=document.createElement("li");f.classList.add("font-list-item"),f.classList.add("background-hover");var g=document.createElement("button");g.type="button",g.id="font-button-"+e+this.fontManager.selectorSuffix,g.classList.add("font-button"),g.textContent=a.family;var h=function(){c.toggleExpanded(),c.setActiveFont(a.family)};g.onclick=h,g.onkeypress=h,f.appendChild(g),b?this.ul.insertBefore(f,this.ul.children[b]):this.ul.appendChild(f)},a.prototype.closeEventListener=function(a){for(var b=a.target,c=document.getElementById("font-picker"+this.fontManager.selectorSuffix);;){if(b===c)return;if(b.parentNode)b=b.parentNode;else return void this.toggleExpanded()}},a.prototype.toggleExpanded=function(){this.expanded?(this.expanded=!1,this.fontPickerDiv.classList.remove("expanded"),document.removeEventListener("click",this.closeEventListener)):(this.expanded=!0,this.fontPickerDiv.classList.add("expanded"),document.addEventListener("click",this.closeEventListener))},a.prototype.getFonts=function(){return this.fontManager.getFonts()},a.prototype.addFont=function(a,b){if(Array.from(this.fontManager.getFonts().keys()).includes(a))throw Error("Did not add font to font picker: Font family \""+a+"\" is already in the list");this.fontManager.addFont(a,!0);var c=this.fontManager.getFonts().get(a);c?this.addFontLi(c,b):console.error("Font \""+a+"\" is missing in font list")},a.prototype.removeFont=function(a){this.fontManager.removeFont(a);var b=d(a),c=document.getElementById("font-button-"+b+this.fontManager.selectorSuffix);if(c){var e=c.parentElement;c.remove(),e&&e.remove()}else throw Error("Could not remove font from font picker: Font family \""+a+"\" is not in the list")},a.prototype.getActiveFont=function(){return this.fontManager.getActiveFont()},a.prototype.setActiveFont=function(a){this.fontManager.setActiveFont(a);var b=d(a);this.dropdownFamily.textContent=a,this.activeFontButton?(this.activeFontButton.classList.remove("active-font"),this.activeFontButton=document.getElementById("font-button-"+b+this.fontManager.selectorSuffix),this.activeFontButton.classList.add("active-font")):console.error("`activeFontButton` is undefined")},a.prototype.setOnChange=function(a){this.fontManager.setOnChange(a)},a}();return B});
